# Auto.ria Scraper

## ðŸ—ï¸ ÐÑ€Ñ…Ñ–Ñ‚ÐµÐºÑ‚ÑƒÑ€Ð°
Ð¦ÐµÐ¹ Ð¿Ñ€Ð¾Ñ”ÐºÑ‚ Ð²Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð¾Ð²ÑƒÑ” **FastAPI** Ð´Ð»Ñ ÑÐµÑ€Ð²ÐµÑ€Ð½Ð¾Ñ— Ñ‡Ð°ÑÑ‚Ð¸Ð½Ð¸.

### ðŸ“ Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° Ð¿Ñ€Ð¾Ñ”ÐºÑ‚Ñƒ

app/
â”œâ”€â”€ database/               # Ð—Ð±ÐµÑ€ÐµÐ¶ÐµÐ½Ð½Ñ Ð´Ð°Ð½Ð¸Ñ… Ñ‚Ð° Ð¾Ð±ÑÐ»ÑƒÐ³Ð¾Ð²ÑƒÐ²Ð°Ð½Ð½Ñ
â”‚   â””â”€â”€ database.py         # ÐœÐ¾Ð´ÐµÐ»Ñ– SQLAlchemy, Ð»Ð¾Ð³Ñ–ÐºÐ° UPSERT Ñ‚Ð° Ñ‚Ñ€Ð¸Ð³ÐµÑ€Ð¸ Ð±ÐµÐºÐ°Ð¿Ñƒ
â”œâ”€â”€ scraper/                # ÐžÑÐ½Ð¾Ð²Ð½Ð¸Ð¹ Ñ€ÑƒÑˆÑ–Ð¹ ÑÐºÑ€Ð°Ð¿Ñ–Ð½Ð³Ñƒ
â”‚   â”œâ”€â”€ scraper.py          # Ð›Ð¾Ð³Ñ–ÐºÐ° Ð°ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð½Ð¸Ñ… Ð²Ð¾Ñ€ÐºÐµÑ€Ñ–Ð² Ñ‚Ð° ÐºÐµÑ€ÑƒÐ²Ð°Ð½Ð½Ñ Ñ‡ÐµÑ€Ð³Ð¾ÑŽ
â”‚   â””â”€â”€ car_card_parser.py  # Ð›Ð¾Ð³Ñ–ÐºÐ° BeautifulSoup Ð´Ð»Ñ Ð²Ð¸Ñ‚ÑÐ³ÑƒÐ²Ð°Ð½Ð½Ñ Ð´Ð°Ð½Ð¸Ñ… Ð¿Ñ€Ð¾ Ð°Ð²Ñ‚Ð¾
â””â”€â”€ server/                 # API ÑˆÐ°Ñ€ (FastAPI)
    â”œâ”€â”€ server.py           # Ð•Ð½Ð´Ð¿Ð¾Ñ–Ð½Ñ‚Ð¸, BackgroundTasks Ñ‚Ð° Ð¶Ð¸Ñ‚Ñ‚Ñ”Ð²Ð¸Ð¹ Ñ†Ð¸ÐºÐ» (ÐŸÐ»Ð°Ð½ÑƒÐ²Ð°Ð»ÑŒÐ½Ð¸Ðº)
    â””â”€â”€ server_states.py    # Ð“Ð»Ð¾Ð±Ð°Ð»ÑŒÐ½Ðµ ÐºÐµÑ€ÑƒÐ²Ð°Ð½Ð½Ñ ÑÑ‚Ð°Ð½Ð¾Ð¼ (Ð‘Ð»Ð¾ÐºÑƒÐ²Ð°Ð½Ð½Ñ ÑÐºÑ€Ð°Ð¿ÐµÑ€Ð°)

## Ð’ÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð½Ñ Ñ‚Ð° Ð½Ð°Ð»Ð°ÑˆÑ‚ÑƒÐ²Ð°Ð½Ð½Ñ

1. ÐšÐ»Ð¾Ð½ÑƒÐ¹Ñ‚Ðµ Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ñ–Ð¹:
git clone https://github.com/vitaleekbliz/TT_data-ox.git

2. Ð’ÑÑ‚Ð°Ð½Ð¾Ð²Ñ–Ñ‚ÑŒ Docker Desktop.

3. Ð¡Ñ‚Ð²Ð¾Ñ€Ñ–Ñ‚ÑŒ Ñ„Ð°Ð¹Ð» .env Ð°Ð±Ð¾ Ð·Ð°Ð¿ÑƒÑÑ‚Ñ–Ñ‚ÑŒ Docker Compose Ð· Ð¿Ñ€Ð°Ð¿Ð¾Ñ€Ñ†ÑÐ¼Ð¸ -e Ð´Ð»Ñ Ð·Ð¼Ñ–Ð½Ð½Ð¸Ñ… Ð¾Ñ‚Ð¾Ñ‡ÐµÐ½Ð½Ñ:

POSTGRES_USER="my_user"
POSTGRES_PASSWORD="my_secure_password"
POSTGRES_DB="app_db"
DATABASE_URL="postgresql+asyncpg://my_user:my_secure_password@db:5432/app_db"
API_PORT="8000"
BASE_URL="https://auto.ria.com/uk/search/?search_type=1&order=7&limit=100"

4. Ð’ÑÑ‚Ð°Ð½Ð¾Ð²Ñ–Ñ‚ÑŒ Ð·Ð°Ð»ÐµÐ¶Ð½Ð¾ÑÑ‚Ñ– Python (Ð¾Ð¿Ñ†Ñ–Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾, Ð´Ð»Ñ Ð¿ÐµÑ€ÐµÐ³Ð»ÑÐ´Ñƒ ÐºÐ¾Ð´Ñƒ Ñ‚Ð° Ñ€Ð¾Ð·Ñ€Ð¾Ð±ÐºÐ¸):

*Windows*
python -m venv .venv
.venv\Scripts\activate
pip install -r requirements.txt

*Linux/Mac*
python3 -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt

5. Ð—Ð°Ð¿ÑƒÑÐº Docker ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ñ–Ð²:
docker-compose up -d --build

## Ð’Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð°Ð½Ð½Ñ 

Ð”Ð»Ñ Ð·Ñ€ÑƒÑ‡Ð½Ð¾ÑÑ‚Ñ– Ð²Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð¾Ð²ÑƒÐ¹Ñ‚Ðµ ÑÑ‚Ð¾Ñ€Ñ–Ð½ÐºÑƒ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ñ–Ñ—: localhost:8000/docs

### ðŸ“¡ API Ð•Ð½Ð´Ð¿Ð¾Ñ–Ð½Ñ‚Ð¸

| Ð•Ð½Ð´Ð¿Ð¾Ñ–Ð½Ñ‚         | ÐœÐµÑ‚Ð¾Ð´ | ÐžÐ¿Ð¸Ñ                                                                 |
| :--------------- | :---: | :------------------------------------------------------------------- |
| /start_scraping  | GET   | Ð—Ð°Ð¿ÑƒÑÐºÐ°Ñ” Ñ„Ð¾Ð½Ð¾Ð²Ð¸Ð¹ ÑÐºÑ€Ð°Ð¿ÐµÑ€. ÐŸÐ°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð¸ Ð·Ð°Ð¿Ð¸Ñ‚Ñƒ: limit (ÑÑ‚Ð¾Ñ€Ñ–Ð½ÐºÐ¸), workers|
| /health          | GET   | ÐŸÐ¾Ð²ÐµÑ€Ñ‚Ð°Ñ” ÑÑ‚Ð°Ñ‚ÑƒÑ Ñ€Ð¾Ð±Ð¾Ñ‚Ð¸ ÑÐµÑ€Ð²ÐµÑ€Ð°                                       |
| /save_dump       | GET   | Ð’Ñ€ÑƒÑ‡Ð½Ñƒ Ð·Ð°Ð¿ÑƒÑÐºÐ°Ñ” ÑÑ‚Ð²Ð¾Ñ€ÐµÐ½Ð½Ñ .sql.gz Ð´Ð°Ð¼Ð¿Ñƒ Ð±Ð°Ð·Ð¸ Ð´Ð°Ð½Ð¸Ñ… Ñƒ Ð¿Ð°Ð¿ÐºÑƒ /dumps    |

1. ÐŸÑ€Ð¸ Ð·Ð°Ð¿ÑƒÑÐºÑƒ ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ð° ÑÐµÑ€Ð²ÐµÑ€Ð° Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡Ð½Ð¾ Ð°ÐºÑ‚Ð¸Ð²ÑƒÑŽÑ‚ÑŒÑÑ Ñ‰Ð¾Ð´ÐµÐ½Ð½Ñ– Ð´Ð°Ð¼Ð¿Ð¸ Ð±Ð°Ð·Ð¸ Ð´Ð°Ð½Ð¸Ñ…. ÐŸÐµÑ€ÑˆÐ¸Ð¹ Ð·Ð°Ð¿ÑƒÑÐº Ð²Ñ–Ð´Ð±ÑƒÐ´ÐµÑ‚ÑŒÑÑ Ñ‡ÐµÑ€ÐµÐ· Ñ…Ð²Ð¸Ð»Ð¸Ð½Ñƒ (Ð´Ð»Ñ Ñ‚ÐµÑÑ‚ÑƒÐ²Ð°Ð½Ð½Ñ).
*ÐŸÑ€Ð¸Ð¼Ñ–Ñ‚ÐºÐ°: Ð’Ð¸ Ñ‚Ð°ÐºÐ¾Ð¶ Ð¼Ð¾Ð¶ÐµÑ‚Ðµ Ñ–Ð½Ñ–Ñ†Ñ–ÑŽÐ²Ð°Ñ‚Ð¸ Ð·Ð±ÐµÑ€ÐµÐ¶ÐµÐ½Ð½Ñ Ð²Ñ€ÑƒÑ‡Ð½Ñƒ Ñ‡ÐµÑ€ÐµÐ· Ð¼ÐµÑ‚Ð¾Ð´ API "save_dump".*

2. Ð—Ð°Ð¿ÑƒÑÑ‚Ñ–Ñ‚ÑŒ ÑÐºÑ€Ð°Ð¿ÐµÑ€ Ð·Ð° Ð´Ð¾Ð¿Ð¾Ð¼Ð¾Ð³Ð¾ÑŽ Ð¼ÐµÑ‚Ð¾Ð´Ñƒ "start_scraping", ÑÐºÐ¸Ð¹ Ð¼Ð°Ñ” 2 Ð¾Ð¿Ñ†Ñ–Ð¾Ð½Ð°Ð»ÑŒÐ½Ñ– Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ð¸: ÐºÑ–Ð»ÑŒÐºÑ–ÑÑ‚ÑŒ Ð²Ð¾Ñ€ÐºÐµÑ€Ñ–Ð² (workers) Ñ‚Ð° Ð»Ñ–Ð¼Ñ–Ñ‚ ÑÑ‚Ð¾Ñ€Ñ–Ð½Ð¾Ðº Ð´Ð»Ñ Ð¿Ð¾ÑˆÑƒÐºÑƒ (limit).
Ð¯ÐºÑ‰Ð¾ ÑÐºÑ€Ð°Ð¿ÐµÑ€ ÑƒÐ¶Ðµ Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½Ð¸Ð¹, Ð²Ð¸ Ð½Ðµ Ð·Ð¼Ð¾Ð¶ÐµÑ‚Ðµ Ð·Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ð¸ Ñ‰Ðµ Ð¾Ð´Ð¸Ð½ (Ð·Ð°Ð¿Ð¾Ð±Ñ–Ð¶Ð½Ð¸Ðº).

3. Ð”Ð¾Ñ‡ÐµÐºÐ°Ð¹Ñ‚ÐµÑÑ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð½Ñ Ñ€Ð¾Ð±Ð¾Ñ‚Ð¸ ÑÐºÑ€Ð°Ð¿ÐµÑ€Ð° (Ð¿ÐµÑ€ÐµÐ²Ñ–Ñ€ÑÐ¹Ñ‚Ðµ Ð»Ð¾Ð³Ð¸ Ð°Ð±Ð¾ Ð±Ð°Ð·Ñƒ Ð´Ð°Ð½Ð¸Ñ…).

ÐŸÑ€Ð¸ÐºÐ»Ð°Ð´ Ð»Ð¾Ð³Ñ–Ð²:
Found 3156 pages to scrape.
Limiting pages for testing : 10
Queue filled with 1010 links. Starting 3 workers...
Successfully sent 50 cars to database upsert function (worker : 2).
Successfully saved 50 cars to database.
...
Scraping Complete.

4. Ð’Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð¾Ð²ÑƒÐ¹Ñ‚Ðµ pgAdmin Ð´Ð»Ñ Ð¿ÐµÑ€ÐµÐ³Ð»ÑÐ´Ñƒ Ð±Ð°Ð·Ð¸ Ð´Ð°Ð½Ð¸Ñ…:

4.1 Ð’Ñ–Ð´ÐºÑ€Ð¸Ð¹Ñ‚Ðµ http://localhost:8080/

4.2 Ð£Ð²Ñ–Ð¹Ð´Ñ–Ñ‚ÑŒ:
   * user: admin@admin.com
   * pass: admin

4.3 Ð’Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð¾Ð²ÑƒÐ¹Ñ‚Ðµ Ð·Ð¼Ñ–Ð½Ð½Ñ– Ð· .env:
   * Host name/address: db 
   * Port: 5432
   * Maintenance database: app_db
   * Username: my_user
   * Password: my_secure_password

4.4 ÐŸÐµÑ€ÐµÐ¹Ð´Ñ–Ñ‚ÑŒ: Servers > Scraper DB > Databases > app_db > Schemas > public > Tables.
    ÐÐ°Ñ‚Ð¸ÑÐ½Ñ–Ñ‚ÑŒ Ð¿Ñ€Ð°Ð²Ð¾ÑŽ ÐºÐ½Ð¾Ð¿ÐºÐ¾ÑŽ Ð½Ð° Ñ‚Ð°Ð±Ð»Ð¸Ñ†ÑŽ 'cars' Ñ‚Ð° Ð¾Ð±ÐµÑ€Ñ–Ñ‚ÑŒ View/Edit Data > All Rows.